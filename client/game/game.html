<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<style>
#picture {
	position: absolute;
}
.display, .rectangle {
	position: absolute;
	z-index: 9999;
	width: 1000px;
	height: 700px;
	border-radius: 20px;
	background-color: #f4d942;
	border: 2px solid #ccc; 
}
.rectangle {
	top: 0px;
	left: 0px;
}
#title{
	font-size: 30px;
}
</style>
</head>
<body>
	<canvas id="ctx" width="1000" height="700" style="border: 1px solid #000000;"></canvas>
	
	<div id="optionsSelectInGame" class="rectangle">
			<p align="Center" id= "title">OPTIONS</p>
			<p align="Center"> Push "q" to return to the game</p>
	</div>

<script>
var pauseGame = false;

$(document).ready(function() {
	var socket = io();
	$(optionsSelectInGame).hide();
	var ctx = document.getElementById("ctx").getContext("2d");
	ctx.font = '30px Arial';
	
	var user = sessionStorage.getItem("username");
	var gameID = sessionStorage.getItem("gameID");
	var gameConfig = sessionStorage.getItem("roomConfig");
	console.log()
	
	socket.on('connect', function(){
		socket.emit('startGame', ("game-"+gameID), user, gameConfig);
	});
	
	// Updates Player In-Game Position
	socket.on('newPositions', function(data) {
		ctx.clearRect(0, 0, 1000, 700);
		for(var i = 0; i < data.player.length; i++){
			ctx.fillStyle = data.player[i].color;
			ctx.fillRect(data.player[i].x,data.player[i].y,data.player[i].width,data.player[i].height);	
			ctx.fillRect(data.player[i].healthX, data.player[i].healthY, data.player[i].HP*40, 20);		
			
			}
		for(var i = 0 ; i < data.projectile.length; i++)	{
			ctx.fillStyle = data.projectile[i].color;
			ctx.fillRect(data.projectile[i].x,data.projectile[i].y,20,20);		
		}
		//for(var i = 0 ; i < data.obstacle.length; i++)	{
		//	ctx.fillStyle = "0000FF"
		//	ctx.fillRect(data.obstacles[i].x,data.obstacles[i].y,20,20);		
		//}
	});
	document.onkeydown = function(event) {
		if (event.keyCode === 68) { //d
			socket.emit('keyPress', {
				inputId : 'right',
				state : true
			});
		}
		else if (event.keyCode === 83) { //s
			socket.emit('keyPress', {
				inputId : 'down',
				state : true
			});
		}
		else if (event.keyCode === 65) { //a
			socket.emit('keyPress', {
				inputId : 'left',
				state : true
			});
		}
		else if (event.keyCode === 87) { //w
			socket.emit('keyPress', {
				inputId : 'up',
				state : true
			});
		}
		else if (event.keyCode === 81) { //p
			socket.emit('keyPress', {
				inputId : 'pause',
				state : true
			});//button toggle
			if((pauseGame === true)){
				$("#optionsSelectInGame").hide();
				pauseGame = false;
			}
			else {
				$("#optionsSelectInGame").show();
				pauseGame = true;
			}
			
		}
	}
	document.onkeyup = function(event) {
		if (event.keyCode === 68) { //d
			socket.emit('keyPress', {
				inputId : 'right',
				state : false
			});
		}
		else if (event.keyCode === 83) { //s
			socket.emit('keyPress', {
				inputId : 'down',
				state : false
			});
		}
		else if (event.keyCode === 65) { //a
			socket.emit('keyPress', {
				inputId : 'left',
				state : false
			});
		}
		else if (event.keyCode === 87) { //w
			socket.emit('keyPress', {
				inputId : 'up',
				state : false
			});
		}
		else if (event.keyCode === 9) { //tab
			socket.emit('keyPress', {
				inputId : 'pause',
				state : false
			});
			
		}
	}
	
	document.onmousedown = function(event){
        socket.emit('keyPress',{inputId:'attack',state:true});
    }
    document.onmouseup = function(event){
        socket.emit('keyPress',{inputId:'attack',state:false});
    }
    document.onmousemove = function(event){
        var x = -250 + event.clientX - 8;
        var y = -250 + event.clientY - 8;
        var angle = Math.atan2(y,x) / Math.PI * 180;
        socket.emit('keyPress',{inputId:'mouseAngle',state:angle});
    }
    
	
});
</script>
</body>
</html>