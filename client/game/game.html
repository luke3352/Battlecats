<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<style>
#picture {
	position: absolute;
}
</style>
</head>
<body>
	<canvas id="ctx" width="1000" height="700" style="border: 1px solid #000000;"></canvas>
	
	<div id="optionsSelectInGame">
		<div class="rectangle">
			<p align="Center">OPTIONS</p>
			<button style="align: 'left'" id="buttonBackInGame">Back</button>
		</div>
	</div>

<script>
$(document).ready(function() {
	var socket = io();

	var ctx = document.getElementById("ctx").getContext("2d");
	
	// Updates Player In-Game Position
	socket.on('newPositions', function(data) {
		ctx.clearRect(0, 0, 1000, 700);
		for(var i = 0; i < data.player.length; i++){
			ctx.fillStyle = "#4169e1";
			ctx.fillRect(data.player[i].x,data.player[i].y,data.player[i].width,data.player[i].height);		
			}
		for(var i = 0 ; i < data.projectile.length; i++)	{
			ctx.fillStyle = "#800080";
			ctx.fillRect(data.projectile[i].x,data.projectile[i].y,20,20);		
		}
	});
	document.onkeydown = function(event) {
		if (event.keyCode === 68) { //d
			socket.emit('keyPress', {
				inputId : 'right',
				state : true
			});
		}
		else if (event.keyCode === 83) { //s
			socket.emit('keyPress', {
				inputId : 'down',
				state : true
			});
		}
		else if (event.keyCode === 65) { //a
			socket.emit('keyPress', {
				inputId : 'left',
				state : true
			});
		}
		else if (event.keyCode === 87) { //w
			socket.emit('keyPress', {
				inputId : 'up',
				state : true
			});
		}
		else if (event.keyCode === 9) { //tab
			$(optionsSelectInGame).show();
		}
	}
	document.onkeyup = function(event) {
		if (event.keyCode === 68) { //d
			socket.emit('keyPress', {
				inputId : 'right',
				state : false
			});
		}
		else if (event.keyCode === 83) { //s
			socket.emit('keyPress', {
				inputId : 'down',
				state : false
			});
		}
		else if (event.keyCode === 65) { //a
			socket.emit('keyPress', {
				inputId : 'left',
				state : false
			});
		}
		else if (event.keyCode === 87) { //w
			socket.emit('keyPress', {
				inputId : 'up',
				state : false
			});
		}
		else if (event.keyCode === 9) { //tab
			$(optionsSelectInGame).hide();
		}
	}
	
	document.onmousedown = function(event){
        socket.emit('keyPress',{inputId:'attack',state:true});
    }
    document.onmouseup = function(event){
        socket.emit('keyPress',{inputId:'attack',state:false});
    }
    document.onmousemove = function(event){
        var x = -250 + event.clientX - 8;
        var y = -250 + event.clientY - 8;
        var angle = Math.atan2(y,x) / Math.PI * 180;
        socket.emit('keyPress',{inputId:'mouseAngle',state:angle});
    }
    
	
});
</script>
</body>
</html>